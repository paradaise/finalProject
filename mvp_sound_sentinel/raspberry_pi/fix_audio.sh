#!/bin/bash

echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É–¥–∏–æ –¥–ª—è Raspberry Pi Sound Sentinel..."

# –û–±–Ω–æ–≤–ª—è–µ–º —Å–∏—Å—Ç–µ–º—É
echo "üì¶ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤..."
sudo apt update

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã –¥–ª—è –∞—É–¥–∏–æ
echo "üé§ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞—É–¥–∏–æ –ø–∞–∫–µ—Ç–æ–≤..."
sudo apt install -y alsa-utils pulseaudio pulseaudio-utils

# –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è ALSA
echo "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ALSA..."
sudo tee /etc/asound.conf > /dev/null <<EOF
pcm.!default {
    type pulse
}
ctl.!default {
    type pulse
}
EOF

# –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
mkdir -p ~/.config/pulse
echo "üîä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PulseAudio..."

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –∞—É–¥–∏–æ —Å–µ—Ä–≤–∏—Å—ã
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞—É–¥–∏–æ —Å–µ—Ä–≤–∏—Å–æ–≤..."
sudo systemctl restart alsa-state 2>/dev/null || true
pulseaudio --kill 2>/dev/null || true
sleep 2
pulseaudio --start 2>/dev/null || true

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
echo "üéß –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞—É–¥–∏–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤..."
arecord -l

echo ""
echo "‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É–¥–∏–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo "üí° –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:"
echo "   1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å Raspberry Pi: sudo reboot"
echo "   2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å USB –º–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–∞–ø—Ä—è–º—É—é"
echo "   3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞: sudo usermod -a -G audio $USER"
